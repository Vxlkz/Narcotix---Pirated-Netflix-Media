<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Narcotix | Pirated Netflix</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
  <style>
    /* Your existing styles remain unchanged */
  </style>
</head>

<body>
  <!-- Navbar Section -->
  <div class="navbar" id="navbar">
    <img alt="Logo" src="https://i.ibb.co/gjBrfcB/c3f62d75a54648c3fcec0d618c004e66.png" width="120" />
    <div class="right-icons">
      <i class="fas fa-search" onclick="toggleSearchBox()"></i>
      <i class="fas fa-tv screen-share-icon" onclick="startScreenSharing()" title="Cast This Page"></i>
      <i class="fas fa-bell"></i>
      <i class="fas fa-user"></i>
    </div>
  </div>

  <!-- Movie Categories Sections -->
  <!-- Your movie categories and rows remain unchanged -->

  <!-- Scroll Extender -->
  <div id="scrollEnd"></div>

  <!-- Movie Embed Modal -->
  <div id="movieEmbed">
    <iframe id="movieIframe" src="" frameborder="0" allowfullscreen></iframe>
    <button id="closeBtn" onclick="closeEmbed()">Ã—</button>
  </div>

  <script>
    const apiKey = 'd4d5dc37aeb71914016166a958fbe3db';

    // Fetch movies by genre
    function fetchMoviesByGenre(genreId, rowId) {
      fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_genres=${genreId}&language=en-US&page=1`)
        .then(response => response.json())
        .then(data => {
          const movies = data.results;
          const row = document.getElementById(rowId);
          row.innerHTML = '';
          movies.forEach(movie => {
            const movieElement = document.createElement('img');
            movieElement.src = `https://image.tmdb.org/t/p/w500${movie.poster_path}`;
            movieElement.alt = movie.title;
            movieElement.onclick = () => openMovieEmbed(movie.id);
            row.appendChild(movieElement);
          });
        });
    }

    // Screen sharing logic
    function startScreenSharing() {
      if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {
        navigator.mediaDevices.getDisplayMedia({ video: true })
          .then(stream => {
            castScreenToDevice(stream);
          })
          .catch(err => {
            console.log("Screen sharing failed: ", err);
          });
      } else {
        alert("Screen sharing is not supported in this browser.");
      }
    }

    // Google Cast API initialization
    function initializeCastApi() {
      cast.framework.CastContext.getInstance().setOptions({
        receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
        autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
      });
    }

    window['__onGCastApiAvailable'] = function (loaded, errorInfo) {
      if (loaded) {
        initializeCastApi();
      } else {
        console.log("Google Cast API not available:", errorInfo);
      }
    };

    // Function to cast screen to Chromecast device
    function castScreenToDevice(stream) {
      const castSession = cast.framework.CastContext.getInstance().getCurrentSession();
      if (castSession) {
        const mediaInfo = new chrome.cast.media.MediaInfo('screen', 'video/mp4'); // You can adjust the MIME type if needed
        mediaInfo.stream = stream;
        const request = new chrome.cast.media.LoadRequest(mediaInfo);
        castSession.loadMedia(request, function () {
          console.log('Screen successfully casted to TV');
        }, function (error) {
          console.log('Error casting screen to TV:', error);
        });
      } else {
        alert("No Chromecast device is available.");
      }
    }

    // Fetch movies for each genre (this part remains unchanged)
    fetchMoviesByGenre(28, 'movieRowAction');
    fetchMoviesByGenre(12, 'movieRowAdventure');
    fetchMoviesByGenre(16, 'movieRowAnimation');
    fetchMoviesByGenre(35, 'movieRowComedy');
    fetchMoviesByGenre(80, 'movieRowCrime');
    fetchMoviesByGenre(99, 'movieRowDocumentary');
    fetchMoviesByGenre(18, 'movieRowDrama');
    fetchMoviesByGenre(10751, 'movieRowFamily');
    fetchMoviesByGenre(14, 'movieRowFantasy');
    fetchMoviesByGenre(27, 'movieRowHorror');
    fetchMoviesByGenre(10402, 'movieRowMusic');
    fetchMoviesByGenre(9648, 'movieRowMystery');
    fetchMoviesByGenre(10749, 'movieRowRomance');
    fetchMoviesByGenre(53, 'movieRowThriller');
    fetchMoviesByGenre(10752, 'movieRowWar');
    fetchMoviesByGenre(37, 'movieRowWestern');
  </script>
</body>

</html>
